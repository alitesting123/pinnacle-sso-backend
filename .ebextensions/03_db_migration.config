container_commands:
  01_run_migration:
    command: |
      echo "======================================"
      echo "Running database migration..."
      echo "======================================"

      # Check if psql is available
      if ! command -v psql &> /dev/null; then
          echo "ERROR: psql not found. Installing..."
          yum install -y postgresql
      fi

      # Run the migration
      if [ -f migrations/add_ai_generated_field.sql ]; then
          echo "Found migration file, executing..."
          psql "$DATABASE_URL" -f migrations/add_ai_generated_field.sql 2>&1

          if [ $? -eq 0 ]; then
              echo "✓ Migration completed successfully!"
          else
              echo "⚠ Migration may have already been applied (this is okay)"
          fi
      else
          echo "⚠ Migration file not found at migrations/add_ai_generated_field.sql"
      fi

      echo "======================================"
    leader_only: true
    ignoreErrors: true
