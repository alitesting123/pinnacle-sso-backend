option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: app.main:app

container_commands:
  01_log_pip_installation:
    command: |
      echo "======================================"
      echo "PYTHON PACKAGE INSTALLATION - VERBOSE"
      echo "======================================"
      echo "Requirements file:"
      cat requirements.txt
      echo ""
      echo "======================================"
      echo "Installing packages (this may take 5-10 minutes for ML libraries)..."
      echo "======================================"

      # Install packages with verbose output and timeout
      /var/app/venv/*/bin/pip install -r requirements.txt \
        --verbose \
        --timeout 600 \
        --no-cache-dir 2>&1 | tee /tmp/pip_install.log

      EXIT_CODE=$?

      echo ""
      echo "======================================"
      if [ $EXIT_CODE -eq 0 ]; then
        echo "✓ Package installation completed successfully"
        echo "Installed packages:"
        /var/app/venv/*/bin/pip list
      else
        echo "✗ Package installation FAILED with exit code: $EXIT_CODE"
        echo "Last 50 lines of pip install log:"
        tail -50 /tmp/pip_install.log
      fi
      echo "======================================"

      exit $EXIT_CODE
    leader_only: true
    ignoreErrors: false
